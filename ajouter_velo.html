<meta charset="utf-8"/>
<title>Ajouter un vélo</title>
<style>
    body {
        font: .8em "typewriter", sans-serif;
    }

    label {
        width: 100px;
        display: inline-block;
    }

    fieldset {
        width: 400px;
    }
</style>

<h1>Ajouter un vélo</h1>
<label>Nom</label>
<input type="text" id="" placeholder="Nom">
<br/>
<label>Catégorie</label>
<select id="select-categories"></select>
<button id="" onclick="showAddCategory()">+</button>
<span id="add-category-span" style="visibility:hidden">
  <input type="text" id="add-category-name">
  <button id="" onclick="addCategory()">Ajouter</button>
</span>
<br/>
<label>Prix</label>
<input type="text" id="" placeholder="Prix">
<br/>
<fieldset>
    <legend>Options</legend>
    <div id="option-div">
      <span>
        <input type="text" placeholder="Nom"><input type="text" placeholder="Prix"><button onclick="deleteOption(this)">-</button>
      </span>
    </div>
    <button id="" onclick="addOption()">Ajouter une option</button>
</fieldset>
<br/>
<button id="">Enregistrer</button>

<script>

    const $ = document.getElementById.bind(document);

    refreshSelect();

    function showAddCategory() {
        $("add-category-span").style.visibility = "visible";
    }

    function hideAddCategory() {
        $("add-category-span").style.visibility = "hidden";
    }

    function addCategory() {
        const categoryName = $("add-category-name").value;
        $("select-categories").add(new Option(categoryName));
        saveCategory(categoryName);
        refreshSelect();
        hideAddCategory();
    }

    function saveCategory(category) {
        const categoriesJSON = window.localStorage.getItem("categories");
        const categories = JSON.parse(categoriesJSON) || [];
        console.log(categories);
        categories.push(category);
        window.localStorage.setItem("categories", JSON.stringify(categories));
    }

    function refreshSelect() {
        const categoriesJSON = window.localStorage.getItem("categories");
        const categories = JSON.parse(categoriesJSON) || [];
        categories.sort();
        const selectCategories = $("select-categories");
        categories.forEach(category => selectCategories.add(new Option(category)));
    }

    function addOption() {
        const option = `<span>
                           <input type="text" placeholder="Nom">
                           <input type="text" placeholder="Prix">
                           <button onclick="deleteOption(this)">-</button>
                         </span>`;
        $("option-div").insertAdjacentHTML('afterend', option);
    }

    function deleteOption(node) {
        node.parentNode.remove();
    }

</script>
